---
title:  "í™ˆì„œë²„ë¡œ ë©”ì¼ ì„œë²„ êµ¬ì¶•(2) - ë©”ì¼ ë³´ì•ˆ (SPF, DKIM, DMARC)"
categories: 
  - archiving
tags:
  - homeserver
toc: true
toc_sticky: true
---

## ë©”ì¼ ë³´ì•ˆì„ ì ìš© í•´ë´…ì‹œë‹¤ âœ‰ï¸

ì§€ë‚œ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ë©”ì¼ ì„œë²„ë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.

ë©”ì¼ ì„œë²„ë§Œìœ¼ë¡œë„ ì„œë²„ ë‚´ì—ì„œ ë©”ì¼ì„ ì†¡ìˆ˜ì‹  í•  ìˆ˜ëŠ” ìˆì§€ë§Œ, ì„œë²„ ì™¸ë¶€ë¡œëŠ” ë©”ì¼ì„ ì†¡ìˆ˜ì‹  í•˜ê¸°ê°€ ì–´ë ¤ì›Œìš”.

Gmailì´ë‚˜ ë„¤ì´ë²„ ë©”ì¼ ë“±ì—ì„œëŠ” ë©”ì¼ ì¸ì¦ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•Šì€ ì„œë²„ì—ì„œ ë³´ë‚¸ ë©”ì¼ì„ ìŠ¤íŒ¸ ì²˜ë¦¬í•˜ê±°ë‚˜, ì•„ì˜ˆ ìˆ˜ì‹ ì„ ê±°ë¶€í•˜ê¸°ë„ í•©ë‹ˆë‹¤.

ë”°ë¼ì„œ ìƒì„±í•œ ë©”ì¼ ê³„ì •ì„ ì™¸ë¶€ì—ì„œë„ ììœ ë¡­ê²Œ ì‚¬ìš©í•˜ë ¤ë©´, SPF, DKIM, DMARCì™€ ê°™ì€ ë©”ì¼ ì¸ì¦ í‘œì¤€ì„ ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

## ì„ ìˆ˜ ì§€ì‹ ğŸ§

### 1. SPF

SPF(Sender Policy Framework)ëŠ” ìˆ˜ì‹  ë©”ì¼ ì„œë²„ì—ì„œ ë©”ì¼ì„ ìˆ˜ì‹  ë°›ëŠ” ì‹œì ì— ë°œì‹  ë©”ì¼ ì„œë²„ê°€ ê°€ë¦¬í‚¤ëŠ” IP ì£¼ì†Œê°€ DNS ì„œë²„ì— ë“±ë¡ëœ IPì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤.

<figure class="align-center">
  <img src="/assets/images/mail_SPF.png" alt="SPF ì¸ì¦ ì ˆì°¨" width="98%">
  <figcaption class="img-source">
    ì´ë¯¸ì§€ ì¶œì²˜: <a href="https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html" target="_blank">https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html</a>
  </figcaption>
</figure>

ìœ„ì˜ ê·¸ë¦¼ì„ ë³´ë©´ ë³´ë‹¤ ì‰½ê²Œ ì´í•´ê°€ ë í…ë°ìš”, ë°œì‹  ì¸¡ì€ ë¯¸ë¦¬ ë„ë©”ì¸ DNSì— TXT ë ˆì½”ë“œ í˜•ì‹ìœ¼ë¡œ í—ˆìš©ëœ ì„œë²„ IPë¥¼ ë“±ë¡í•´ë‘ê³ , ìˆ˜ì‹  ì¸¡ì´ IP ì£¼ì†Œë¥¼ í™•ì¸í•  ë•Œ DNS ì„œë²„ë¥¼ í†µí•´ ë“±ë¡ë˜ì–´ ìˆëŠ” IP ì£¼ì†Œì™€ ë™ì¼í•œì§€ ë¹„êµí•©ë‹ˆë‹¤.

ì´ ê³¼ì •ì„ í†µí•´ ë©”ì¼ ì„œë²„ ë„ë©”ì¸ì„ ì‚¬ì¹­í•˜ì§€ ì•Šì•˜ëŠ”ì§€ ê²€ì¦í•  ìˆ˜ ìˆì–´ìš”.

í•˜ì§€ë§Œ, SPFë¡œëŠ” ì™„ì „íˆ ë°œì‹  ë„ë©”ì¸ ì‚¬ì¹­ì„ ë°©ì§€í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— DKIMê³¼ DMARCë¥¼ í•¨ê»˜ ì‚¬ìš©í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

### 2. DKIM

DKIM(Domain Keys Identified Mail)ì€ ë©”ì¼ì´ ì „ì†¡ë˜ëŠ” ê³¼ì • ì¤‘ì— ë³€ì¡°ë˜ì§€ ì•Šì•˜ëŠ”ì§€ë¥¼ ê²€ì¦í•˜ëŠ” ì ˆì°¨ì…ë‹ˆë‹¤.

ë§ì€ ì‚¬ëŒë“¤ì´ DKIMì„ ë°€ë ë´‰ì¸ì— ë¹„ìœ í•˜ê³¤ í•©ë‹ˆë‹¤.

DKIMì˜ ì ˆì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

<figure class="align-center">
  <img src="/assets/images/mail_DKIM.png" alt="DKIM ì¸ì¦ ì ˆì°¨" width="98%">
  <figcaption class="img-source">
    ì´ë¯¸ì§€ ì¶œì²˜: <a href="https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html" target="_blank">https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html</a>
  </figcaption>
</figure>

DKIMì€ ê³µê°œí‚¤, ê°œì¸í‚¤ì˜ ê°œë…ì´ ì‚¬ìš©ë˜ì§€ë§Œ ì–´ë µì§€ ì•ŠìŠµë‹ˆë‹¤.

SPFì—ì„œëŠ” IP ì£¼ì†Œë¥¼ ë„ë©”ì¸ DNSì— ë“±ë¡í•´ë‘ì—ˆë‹¤ë©´, DKIMì—ì„œëŠ” ê³µê°œí‚¤ ì •ë³´ë¥¼ TXT ë ˆì½”ë“œ í˜•ì‹ìœ¼ë¡œ ë“±ë¡í•´ë‘ë©´ ë©ë‹ˆë‹¤.

ì´í›„ì—, ë©”ì¼ ë°œì†¡ ì‹œ DKIM-Signatureì— ê°œì¸í‚¤ë¡œ ì „ìì„œëª… í›„ í—¤ë”ì— í¬í•¨í•˜ì—¬ ì „ì†¡í•˜ë©´, ìˆ˜ì‹  ë©”ì¼ ì„œë²„ì—ì„œ DNSì— ë“±ë¡ë˜ì–´ ìˆëŠ” ë ˆì½”ë“œë¥¼ ì¡°íšŒí•˜ì—¬ ê²€ì¦í•©ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜, DKIMë§Œìœ¼ë¡œëŠ” From ë³€ì¡°ë¥¼ ê²€ì¦í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

DKIMì€ ë„ë©”ì¸ ê²€ì¦ë§Œ í•˜ê¸° ë•Œë¬¸ì—, MAIL FROMê³¼ fromì´ ê°™ì€ì§€ ë¹„êµí•  ìˆ˜ ìˆë„ë¡ DMARCë¥¼ ì¶”ê°€ë¡œ ì ìš©í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

### 3. DMARC

DMARC(Domain-based Message Authentication Reporting Conformance)ëŠ” ë°œì‹ ì ì •ë³´ë¥¼ ìœ„ì¡°í•˜ëŠ” ê²ƒì„ ì˜ˆë°©í•˜ê¸° ìœ„í•œ ê²€ì¦ ë°©ë²•ì…ë‹ˆë‹¤.

DMARCëŠ” SPFì™€ DKIMì— Reportingì´ í•©ì³ì ¸ ìˆëŠ”ë°ìš”, ì•„ë˜ê°€ DMARCì˜ ì ˆì°¨ì…ë‹ˆë‹¤.

<figure class="align-center">
  <img src="/assets/images/mail_DMARC.png" alt="DMARC ì¸ì¦ ì ˆì°¨" width="98%">
  <figcaption class="img-source">
    ì´ë¯¸ì§€ ì¶œì²˜: <a href="https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html" target="_blank">https://www.crinity.net/Newsletter/2019/06/Coffee_Break.html</a>
  </figcaption>
</figure>

SPFì™€ DKIMì„ ë‘˜ ë‹¤ ì‚¬ìš©í•´ì„œ ë©”ì¼ ì„œë²„ ë„ë©”ì¸ ì‚¬ì¹­ê³¼ ë‚´ìš©ë¬¼ ë³€ì¡° ì—¬ë¶€ë¥¼ ê²€ì¦í•©ë‹ˆë‹¤.

ì´í›„ì— ë©”ì¼ì´ SPF, DKIM ì¸ì¦ ì ˆì°¨ë¥¼ í†µê³¼í•˜ì§€ ëª»í•œë‹¤ë©´ DMARC ì •ì±…ì´ ì ìš©ë˜ëŠ”ë°, ì´ ë•Œ ì‚¬ìš©ìê°€ ì„¤ì •í•œ ì •ì±…ì— ë”°ë¼ ë©”ì¼ì„ ìŠ¤íŒ¸ ì²˜ë¦¬í•˜ê±°ë‚˜ ê±°ë¶€í•˜ê³ , ê²€ì¦ ê²°ê³¼ë¥¼ ë³´ê³ ì„œë¡œ ì„¤ì •ëœ ì£¼ì†Œì— ë°œì†¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë•Œ ì •ì±…ì€ ë„ë©”ì¸ DNSì— TXT ë ˆì½”ë“œ í˜•ì‹ìœ¼ë¡œ ë“±ë¡í•˜ë©´ ë©ë‹ˆë‹¤.

## ë©”ì¼ ë³´ì•ˆ ì ìš©í•˜ê¸° ğŸ‘®â€â™€ï¸

### 0. PTR ë ˆì½”ë“œ

ì ì´ì œ ë©”ì¼ ë³´ì•ˆì„ ì ìš©í•˜ê¸°ì— ì•ì„œ, ê°€ì¥ ë¨¼ì € í•´ì£¼ì–´ì•¼ í•  ê³¼ì •ì´ ìˆìŠµë‹ˆë‹¤.

ë„ë©”ì¸ê³¼ IPë¥¼ ì—°ê²°í•  ë•Œì—ëŠ” IP ì£¼ì†Œê°€ ë„ë©”ì¸ì„ ê°€ë¦¬í‚¬ ìˆ˜ ìˆë„ë¡ **A ë ˆì½”ë“œ**ë¥¼ ì¶”ê°€í•´ì¤¬ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ, ë©”ì¼ê³¼ ê°™ì€ ê²½ìš°ëŠ” ë„ë©”ì¸ì´ ì–´ë–¤ IP ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê³  ìˆëŠ”ì§€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.

ì´ í™•ì¸ ê³¼ì •ì„ ì—­ë°©í–¥ DNS ì¡°íšŒ, í˜¹ì€ ë¦¬ë²„ìŠ¤ DNS ì¡°íšŒë¼ê³  í•©ë‹ˆë‹¤.

PTR ë ˆì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

| Host                          | Type    |Priority     |TTL          |Data              |
|-------------------------------|---------|-------------|-------------|------------------|
| [**ë’¤ì§‘ì€ ê³µì¸ IP**].in-addr.arpa| PTR     | N/A         | 4 hrs       |mail.[yourdomain] |

ì •ë§ ì •ë§ ì¤‘ìš”í•œ í¬ì¸íŠ¸ëŠ” ê³µì¸ IPë¥¼ ê¸°ì…í•  ë•Œ IP ì£¼ì†Œë¥¼ ë’¤ì§‘ì–´ì„œ í‘œê¸°í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ 123.456.789.987 ì´ë¼ë©´, 987.789.456.123 ì´ë ‡ê²Œ ì ì–´ì£¼ì–´ì•¼ í•´ìš”.

ì œê°€ ì •ë§ ì´ê²ƒ ë•Œë¬¸ì— ê³ ìƒí–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ìƒê° ë³´ë‹¤ ë§ì€ ì‚¬ëŒë“¤ì´ ì´ê²ƒ ë•Œë¬¸ì— ê³ ìƒì„ í•˜ë”ë¼êµ¬ìš”.

ì´ ë‚´ìš©ì€ ì•„ë˜ Squarespace í¬ëŸ¼ì—ì„œ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

[Correct way to set PTR DNS record for mail forwarding](https://forum.squarespace.com/topic/300186-correct-way-to-set-ptr-dns-record-for-mail-forwarding/)

### 1. SPF ì„¤ì •í•˜ê¸° ğŸ¥¸

ì ê·¸ëŸ¬ë©´ SPFë¶€í„° ì„¤ì •ì„ í•´ë´…ì‹œë‹¤!

SPFë¥¼ ìœ„í•œ TXT ë ˆì½”ë“œ ì„¤ì •ì€ êµ‰ì¥íˆ ê°„ë‹¨í•©ë‹ˆë‹¤.

| Host      | Type    |Priority     |TTL          |Data             |
|-----------|---------|-------------|-------------|-----------------|
| @         | TXT     | N/A         | 4 hrs       |v=spf1 ip4:[ê³µì¸ IP] ~all|

ì´ë ‡ê²Œ ì„¤ì •í•´ì£¼ë©´, ë©”ì¼ì˜ ip4ê°€ ì„¤ì •í•œ IPì™€ ë™ì¼í•œ ê²½ìš° ì¸ì¦ ì ˆì°¨ë¥¼ í†µê³¼ ì‹œì¼œì¤ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì € ê°™ì€ ê²½ìš°ëŠ” `~all` ì˜µì…˜ì„ ì‚¬ìš©í–ˆê¸° ë•Œë¬¸ì— SPF ê²€ì¦ì— ì‹¤íŒ¨í•œ ê²½ìš°ì—ë„ ë©”ì¼ì„ ìˆ˜ë½í•˜ì§€ë§Œ, ìˆ˜ì‹  ì„œë²„ì—ì„œ â€˜ì£¼ì˜â€™ ë˜ëŠ” â€˜ìŠ¤íŒ¸â€™ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.

ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë©”ì¼ì„ ì™„ì „íˆ ì°¨ë‹¨í•˜ê³  ì‹¶ë‹¤ë©´ `-all` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤!

### 2. DKIM ì„¤ì •í•˜ê¸° ğŸ“¦

postfixì™€ dovecotìœ¼ë¡œ êµ¬ì„±ëœ í™˜ê²½ì—ì„œëŠ” ë³´í†µ **OpenDKIM**ì„ ì‚¬ìš©í•´ì„œ DKIM ì„¤ì •ì„ í•´ì¤ë‹ˆë‹¤.

ì´ OpenDKIMì„ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì¡°ê¸ˆ ë³µì¡í•˜ì§€ë§Œ, ë©”ì¼ ì„œë²„ë¥¼ êµ¬ì¶•í•˜ëŠ” ê³¼ì •ë³´ë‹¤ëŠ” ë‚˜ìœ¼ë‹ˆ ì²œì²œíˆ í•œ ë²ˆ í•´ë´…ì‹œë‹¤.

ìš°ì„ , OpenDKIMì„ install í•´ì¤ì‹œë‹¤.

```
sudo apt install opendkim opendkim-tools
```

ê·¸ë¦¬ê³ , OpenDKIM ë””ë ‰í† ë¦¬ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— keyë¥¼ ìƒì„±í•´ì¤ë‹ˆë‹¤.

```
# ë””ë ‰í† ë¦¬ ìƒì„±
sudo mkdir -p /etc/opendkim/keys/[yourdomain]
cd /etc/opendkim/keys/[yourdomain]

# í‚¤ ìƒì„±
sudo opendkim-genkey -d [yourdomain] -s [selectorname]
```

ì´ ë•Œ, DKIMì€ selectorë¥¼ ê¸°ë°˜ìœ¼ë¡œ í‚¤ì˜ ì†Œìœ ìë¥¼ êµ¬ë¶„í•˜ëŠ”ë° ê·¸ëƒ¥ ë‹‰ë„¤ì„ ê°™ì€ ê±°ë¼ê³  ìƒê°í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.

ì €ëŠ” selector nameì„ **mail**ë¡œ ì§€ì •í•´ì£¼ì—ˆì–´ìš”.

ì´ ê³¼ì •ì„ ìˆ˜í–‰í•˜ê³  ë‚˜ë©´, `[selectorname].private`, `[selectorname].txt` íŒŒì¼ì´ ìƒì„±ë˜ì–´ ìˆì„ê±°ì˜ˆìš”!

ì´ì–´ì„œ ìƒì„±ëœ íŒŒì¼ì˜ ê¶Œí•œì„ ì„¤ì •í•´ì¤ì‹œë‹¤.

```
sudo chown opendkim:opendkim mail.private 

sudo chmod 640 /etc/opendkim/keys/swlee.net/mail.private
sudo chmod 644 /etc/opendkim/keys/swlee.net/mail.txt
```

ì´ì   ìƒì„±í•œ DKIM ì •ë³´ë¥¼ í† ëŒ€ë¡œ `/etc/opendkim/KeyTable`, `/etc/opendkim/SigningTable`, `/etc/opendkim/TrustedHosts`, `/etc/opendkim.conf` ë¥¼ ì„¤ì •í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

Keytable ë¨¼ì € í•´ë´…ì‹œë‹¤.

`sudo vi /etc/opendkim/KeyTable`ë¡œ vi í¸ì§‘ê¸°ë¥¼ ì—´ì–´ì£¼ê³ , ì•„ë˜ì˜ ë‚´ìš©ì„ ê¸°ì…í•´ì¤ì‹œë‹¤.

```
# í‚¤ í…Œì´ë¸”ì´ ì‚¬ìš©í•  DKIM í‚¤ì˜ ê²½ë¡œë¥¼ ì‘ì„±í•˜ì—¬, DKIM keyë¥¼ ì„ ì–¸
[selectorname]._domainkey.[yourdomain] [yourdomain]:[selectorname]:/etc/opendkim/keys/[yourdomain]/[selectorname].private
```

[]ë¡œ í‘œê¸°ëœ ë¶€ë¶„ì€ ê¼­ ê°œì¸ì˜ í™˜ê²½ì— ë§ì¶° ìˆ˜ì •í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³ , `sudo vi /etc/opendkim/SigningTable`ë¡œ SigningTableì— ì•„ë˜ ë‚´ìš©ì„ ê¸°ì…í•´ì¤ë‹ˆë‹¤.

```
# ì‚¬ìš©í•  ë©”ì¼ ì£¼ì†Œì™€ í‚¤ í…Œì´ë¸”ì„ ë§¤ì¹­
# *ëŠ” ëª¨ë“  ë©”ì¼ ì£¼ì†Œì— í•´ë‹¹ í‚¤ í…Œì´ë¸”ì„ ë§¤ì¹­í•  ê²ƒì„ ì˜ë¯¸í•¨
*@[yourdomain] [selectorname]._domainkey.[yourdomain]
```

`sudo vi /etc/opendkim/TrustedHosts`ë¡œ TrustedHostsëŠ” ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

```
127.0.0.1
localhost


[ê³µì¸ IP]


[yourdomain]
```

ì´ì œ ë§ˆì§€ë§‰ì…ë‹ˆë‹¤!

`sudo vi /etc/opendkim.conf`ìœ¼ë¡œ OpenDKIM ì•„ë˜ì™€ ê°™ì´ ì„¤ì • íŒŒì¼ì„ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.

```
# This is a basic configuration for signing and verifying. It can easily be
# adapted to suit a basic installation. See opendkim.conf(5) and
# /usr/share/doc/opendkim/examples/opendkim.conf.sample for complete
# documentation of available configuration parameters.

Syslog                  yes
SyslogSuccess           yes
LogWhy                  yes

# Common signing and verification parameters. In Debian, the "From" header is
# oversigned, because it is often the identity key used by reputation systems
# and thus somewhat security sensitive.
Canonicalization        relaxed/simple
Mode                    sv
SubDomains              yes

# fromì´ í—¤ë”ì— ì¤‘ë³µë˜ì–´ dkim ì¸ì¦ ì˜¤ë¥˜ ë°œìƒ - ì£¼ì„ì²˜ë¦¬
#OversignHeaders                From

# Signing domain, selector, and key (required). For example, perform signing
# for domain "example.com" with selector "2020" (2020._domainkey.example.com),
# using the private key stored in /etc/dkimkeys/example.private. More granular
# setup options can be found in /usr/share/doc/opendkim/README.opendkim.
#Domain                 example.com
#Selector               2020
#KeyFile                /etc/dkimkeys/example.private

# ì„¤ì • íŒŒì¼ ì—°ê²°
KeyTable           /etc/opendkim/KeyTable
SigningTable       refile:/etc/opendkim/SigningTable
ExternalIgnoreList refile:/etc/opendkim/TrustedHosts
InternalHosts      refile:/etc/opendkim/TrustedHosts

# In Debian, opendkim runs as user "opendkim". A umask of 007 is required when
# using a local socket with MTAs that access the socket as a non-privileged
# user (for example, Postfix). You may need to add user "postfix" to group
# "opendkim" in that case.
UserID                  opendkim
UMask                   002

# Socket for the MTA connection (required). If the MTA is inside a chroot jail,
# it must be ensured that the socket is accessible. In Debian, Postfix runs in
# a chroot in /var/spool/postfix, therefore a Unix socket would have to be
# configured as shown on the last line below.
# postfix ì—°ê²° ì†Œì¼“
Socket                  local:/run/opendkim/opendkim.sock
Socket                  inet:8891@localhost
#Socket                 inet:8891
#Socket                 local:/var/spool/postfix/opendkim/opendkim.sock

PidFile                 /run/opendkim/opendkim.pid

# Hosts for which to sign rather than verify, default is 127.0.0.1. See the
# OPERATION section of opendkim(8) for more information.
#InternalHosts          192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12

# The trust anchor enables DNSSEC. In Debian, the trust anchor file is provided
# by the package dns-root-data.
TrustAnchorFile         /usr/share/dns/root.key
#Nameservers            127.0.0.1
```

ì´ì œ OpenDKIM ì„¤ì •ì€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤. 

ì´ì œ ì´ OpenDKIM ì†Œì¼“ì„ postfixì— ì—°ê²°í•´ë´…ì‹œë‹¤.

ì§€ë‚œ ë²ˆì— ë‹¤ë£¨ì—ˆë˜ íŒŒì¼ì¸ /etc/postfix/main.cf íŒŒì¼ì„ vi í¸ì§‘ê¸°ë¡œ ì—´ì–´ë´…ì‹œë‹¤.

ì•„ë˜ì˜ 4ì¤„ì„ í•´ë‹¹ íŒŒì¼ ìµœí•˜ë‹¨ì— ì¶”ê°€í•´ì¤„ê²Œìš”!

```
# DKIM
milter_default_action = accept
milter_protocol = 6
smtpd_milters = inet:localhost:8891
non_smtpd_milters = inet:localhost:8891
```

ê·¸ë¦¬ê³ , ë„ë©”ì¸ DNSì— TXT ë ˆì½”ë“œë¥¼ ì¶”ê°€í•´ì¤ì‹œë‹¤.

| Host           | Type    |Priority     |TTL          |Data             |
|----------------|---------|-------------|-------------|-----------------|
| mail._domainkey| TXT     | N/A         | 4 hrs       |[your DKIM]      |

ì—¬ê¸°ì„œ, Dataì—ëŠ” ì•„ê¹Œ ìƒì„±í•œ `/etc/opendkim/keys/[yourdomain]/[selectorname].txt íŒŒì¼ ì•ˆì— ìˆëŠ” ê°’ ì¤‘ ì¼ë¶€ë¥¼ ë„£ì–´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

`sudo cat /etc/opendkim/keys/[yourdomain]/[selectorname].txt`ì„ í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ DKIM keyë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
[selectorname]._domainkey IN      TXT     ( "v=DKIM1; h=sha256; k=rsa; "
          "p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwf6TnXFm5i+OoT6XGWxn7YjqxA3HoqwuoTQjCwVzQTHSQtbOSAwtnG8clastaGHOXzTl3ElgJicLFHKM+e4kNNCJte/sidfSF8tqd1NM7i4PvuMysMTunuaEDy4dNCPKG0+JIugY9hI1zu7/jHE2t5PryTzWKXs7h0TZQqHooVLRDfkRkXhXewoYkcJXpqyKeil+uEr7xgRvzQ"
          "DGr1wY+VSZ3/QS4bEByBRaUKLBZlxxCX9yvHNEIk4oroIE6dVDrRx65Q6jgKKnqyBB2YcSLoKvY1slIU6X6wU1MVCS5BmvnSzZXXIAKUANem2QNSj6/nQ9KL5KJW36bxMsVxi7fQIDAQAB" )  ; ----- DKIM key [selectorname] for [yourdomain]
```

ì´ì œ ì—¬ê¸°ì„œ ê°’ì„ ë°œì·Œí•´ì„œ ì•„ë˜ì™€ ê°™ì´ í¸ì§‘í•´ì¤ë‹ˆë‹¤.

```
v=DKIM1; h=sha256; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAwf6TnXFm5i+OoT6XGWxn7YjqxA3HoqwuoTQjCwVzQTHSQtbOSAwtnG8clastaGHOXzTl3ElgJicLFHKM+e4kNNCJte/sidfSF8tqd1NM7i4PvuMysMTunuaEDy4dNCPKG0+JIugY9hI1zu7/jHE2t5PryTzWKXs7h0TZQqHooVLRDfkRkXhXewoYkcJXpqyKeil+uEr7xgRvzQDGr1wY+VSZ3/QS4bEByBRaUKLBZlxxCX9yvHNEIk4oroIE6dVDrRx65Q6jgKKnqyBB2YcSLoKvY1slIU6X6wU1MVCS5BmvnSzZXXIAKUANem2QNSj6/nQ9KL5KJW36bxMsVxi7fQIDAQAB
```

ì—¬ê¸°ì„œ ì •ë§ ì •ë§ ì¤‘ìš”í•œ ì ì€ 'p=' ë‹¤ìŒì— ì´ì–´ì§€ëŠ” ê³µê°œí‚¤ê°€ í•œ ì¤„ë¡œ ì˜ ì´ì–´ì§€ê³ , ë”°ì˜´í‘œê°€ ì˜¬ë°”ë¥´ê²Œ ë‹«í˜€ ìˆì–´ì•¼ ì •í™•í•˜ê²Œ ì¸ì‹ì´ ë©ë‹ˆë‹¤!

í‚¤ê°’ì´ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ `dig TXT [selectorname]._domainkey.[yourdomain]`ë¥¼ ì‹¤í–‰í•´ë³´ì„¸ìš”!

ë™ì¼í•˜ê²Œ ì˜ ë‚˜ì˜¨ë‹¤ë©´ ì ìš©ì´ ì˜ ë˜ê³  ìˆëŠ” ê²ƒì…ë‹ˆë‹¤.

ê·¸ë¦¬ê³  ì„œë¹„ìŠ¤ ì¬ì‹œì‘!

```
sudo systemctl restart opendkim
sudo systemctl restart postfix
```

### 3. DMARC ì„¤ì •í•˜ê¸° ğŸ“ª

ì´ì œ ì •ë§ ë§ˆì§€ë§‰ ë‹¨ê³„ì…ë‹ˆë‹¤.

ì´ê±´ ì •ë§ ì •ë§ ì‰¬ì›Œìš”.

ë„ë©”ì¸ DNSì— TXT ë ˆì½”ë“œë¥¼ í•˜ë‚˜ë§Œ ì¶”ê°€í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

| Host           | Type    |Priority     |TTL          |Data             |
|----------------|---------|-------------|-------------|-----------------|
| _dmarc         | TXT     | N/A         | 4 hrs       |v=DMARC1; p=none; rua=mailto:[yourmailadd]     |

vëŠ” DMARCì˜ ë²„ì „ ì •ë³´, pëŠ” ì •ì±…, ruaëŠ” ë³´ê³ ì„œë¥¼ ë°›ì„ ë©”ì¼ ì£¼ì†Œë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ìœ„ì˜ Data ì•ˆì˜ ê°’ì€ ë©”ì¼ì´ DMARC ê²€ì¦ì— ì‹¤íŒ¨í•˜ë”ë¼ë„ ì•„ë¬´ëŸ° ì¡°ì¹˜ë¥¼ ì·¨í•˜ì§€ ì•Šê³  ë³´ê³ ì„œë§Œ ë³´ë‚´ë¼ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

ë”°ë¼ì„œ, í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œëŠ” ì¢‹ì§€ë§Œ, ë‚˜ì¤‘ì—ëŠ” ìˆ˜ì •í•´ì£¼ëŠ”ê²Œ ì¢‹ì•„ìš”!

## Thunderbird ì—°ê²° ğŸ¦…

ì, ëª¨ë“  ë³´ì•ˆ ì„¤ì •ì´ ëë‚¬ìŠµë‹ˆë‹¤!

ë©”ì¼ í´ë¼ì´ì–¸íŠ¸ ì¤‘ í•˜ë‚˜ì¸ Thunderbirdë¥¼ ì„¤ì¹˜í•˜ê³ , ë¡œê·¸ì¸ì„ í•´ë´…ì‹œë‹¤.

[Thunderbird ë‹¤ìš´ ë°›ê¸°](https://www.thunderbird.net/ko/)

ìœ„ì˜ ê³¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì¡Œë‹¤ë©´, Thunderbirdì— ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì„ê±°ì˜ˆìš”!

ë¡œê·¸ì¸ ê³¼ì •ì€ ì´ ë¸”ë¡œê·¸ë¥¼ ì°¸ê³ í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

[Postfix, dovecot, letsencrypt ë¥¼ ì´ìš©í•œ ë©”ì¼ì„œë²„ êµ¬ì¶• - 4](https://teem0.com/12)

ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì¸ì´ ë˜ì…¨ê³ , êµ¬ê¸€ ë©”ì¼ì´ë‚˜ ë„¤ì´ë²„ ë©”ì¼ë¡œ ì „ì†¡í•œ ë©”ì¼ì„ ì›ë¬¸ ë³´ê¸° í–ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì´ í‘œê¸°ëœë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤!

<img src="/assets/images/mail_security.png" alt="ë©”ì¼ ë³´ì•ˆ ì¸ì¦" width="98%">
<br>

## ì°¸ê³  ì‚¬ì´íŠ¸ ğŸ”

[[MAILë³´ì•ˆ] SPF (Sender Policy Framework) ë©”ì¼ ë³´ì•ˆ - 1](https://jong-bae.tistory.com/15)

ì´ ì‚¬ì´íŠ¸ì˜ ë©”ì¼ ë³´ì•ˆ ì‹œë¦¬ì¦ˆë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§„í–‰í–ˆìŠµë‹ˆë‹¤!

[open-DKIM ì„¤ì¹˜](https://www.enteroa.com/2016/05/19/open-dkim-%EC%84%A4%EC%B9%98/)

OpenDKIM ì„¤ì • ê´€ë ¨ì€ ì´ í¬ìŠ¤íŠ¸ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤.

[Correct way to set PTR DNS record for mail forwarding](https://forum.squarespace.com/topic/300186-correct-way-to-set-ptr-dns-record-for-mail-forwarding/)

Squarespaceì—ì„œì˜ PTR ë ˆì½”ë“œ ì„¤ì • ë°©ë²•ì— ëŒ€í•œ í† ë¡ ì´ ì´ë£¨ì–´ì§„ Sqarespace forum í˜ì´ì§€ì…ë‹ˆë‹¤.

[Squarespace ë„¤ì„ì„œë²„ì—ì„œ Spacemail DNS ë ˆì½”ë“œ ì„¤ì • ë°©ë²•](https://www.spaceship.com/ko/knowledgebase/set-up-spacemail-dns-records-squarespace/)

Squarespaceì˜ ë ˆì½”ë“œ ì„¤ì • ë°©ë²•ì„ ì°¸ê³ í•œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤!